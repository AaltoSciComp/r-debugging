<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Debugging R code | R debugging</title>
  <meta name="description" content="Materials for Aalto Scientific Computing’s How to debug-course, R part" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Debugging R code | R debugging" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Materials for Aalto Scientific Computing’s How to debug-course, R part" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Debugging R code | R debugging" />
  
  <meta name="twitter:description" content="Materials for Aalto Scientific Computing’s How to debug-course, R part" />
  

<meta name="author" content="Simo Tuomisto" />


<meta name="date" content="2022-04-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="features.html"/>
<link rel="next" href="exercises.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R debugging</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About this course</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements"><i class="fa fa-check"></i><b>1.1</b> Requirements</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="whatis.html"><a href="whatis.html"><i class="fa fa-check"></i><b>2</b> What is debugging</a>
<ul>
<li class="chapter" data-level="2.1" data-path="whatis.html"><a href="whatis.html#the-four-steps-of-debugging"><i class="fa fa-check"></i><b>2.1</b> The four steps of debugging</a></li>
<li class="chapter" data-level="2.2" data-path="whatis.html"><a href="whatis.html#debugging-is-the-art-of-identifying-inconsistency-between-the-expected-and-actual-operation"><i class="fa fa-check"></i><b>2.2</b> Debugging is the art of identifying inconsistency between the expected and actual operation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="features.html"><a href="features.html"><i class="fa fa-check"></i><b>3</b> R features relevant for debugging</a>
<ul>
<li class="chapter" data-level="3.1" data-path="features.html"><a href="features.html#interpreter"><i class="fa fa-check"></i><b>3.1</b> Interpreter</a></li>
<li class="chapter" data-level="3.2" data-path="features.html"><a href="features.html#functions"><i class="fa fa-check"></i><b>3.2</b> Functions</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="features.html"><a href="features.html#r-is-a-functional-language"><i class="fa fa-check"></i><b>3.2.1</b> R is a functional language</a></li>
<li class="chapter" data-level="3.2.2" data-path="features.html"><a href="features.html#lazy-evaluation"><i class="fa fa-check"></i><b>3.2.2</b> Lazy evaluation</a></li>
<li class="chapter" data-level="3.2.3" data-path="features.html"><a href="features.html#r-functions-are-evaluated-in-an-environment"><i class="fa fa-check"></i><b>3.2.3</b> R functions are evaluated in an environment</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="features.html"><a href="features.html#objects"><i class="fa fa-check"></i><b>3.3</b> Objects</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="features.html"><a href="features.html#all-objects-in-r-have-a-base-type"><i class="fa fa-check"></i><b>3.3.1</b> All objects in R have a base type</a></li>
<li class="chapter" data-level="3.3.2" data-path="features.html"><a href="features.html#vectors-are-everywhere-and-they-are-immutable"><i class="fa fa-check"></i><b>3.3.2</b> Vectors are everywhere and they are immutable</a></li>
<li class="chapter" data-level="3.3.3" data-path="features.html"><a href="features.html#base-types-are-extended-using-object-oriented-oo-programming"><i class="fa fa-check"></i><b>3.3.3</b> Base types are extended using object-oriented (OO) programming</a></li>
<li class="chapter" data-level="3.3.4" data-path="features.html"><a href="features.html#method-dispatch"><i class="fa fa-check"></i><b>3.3.4</b> Method dispatch</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="features.html"><a href="features.html#signals-and-error-handling"><i class="fa fa-check"></i><b>3.4</b> Signals and error handling</a></li>
<li class="chapter" data-level="3.5" data-path="features.html"><a href="features.html#libraries"><i class="fa fa-check"></i><b>3.5</b> Libraries</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="features.html"><a href="features.html#libraries-are-usually-compiled"><i class="fa fa-check"></i><b>3.5.1</b> Libraries are usually compiled</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>4</b> Debugging R code</a>
<ul>
<li class="chapter" data-level="4.1" data-path="debugging.html"><a href="debugging.html#tracing-errors"><i class="fa fa-check"></i><b>4.1</b> Tracing errors</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="debugging.html"><a href="debugging.html#traceback"><i class="fa fa-check"></i><b>4.1.1</b> Traceback</a></li>
<li class="chapter" data-level="4.1.2" data-path="debugging.html"><a href="debugging.html#traceback-outside-of-rstudio-editor"><i class="fa fa-check"></i><b>4.1.2</b> Traceback outside of RStudio editor</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="debugging.html"><a href="debugging.html#interactive-debugger"><i class="fa fa-check"></i><b>4.2</b> Interactive debugger</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="debugging.html"><a href="debugging.html#launching-debugger-with-rstudios-rerun-with-debug"><i class="fa fa-check"></i><b>4.2.1</b> Launching debugger with RStudio’s “Rerun with Debug”</a></li>
<li class="chapter" data-level="4.2.2" data-path="debugging.html"><a href="debugging.html#debugger-commands"><i class="fa fa-check"></i><b>4.2.2</b> Debugger commands</a></li>
<li class="chapter" data-level="4.2.3" data-path="debugging.html"><a href="debugging.html#debug-and-debugonce"><i class="fa fa-check"></i><b>4.2.3</b> <code>debug</code> and <code>debugonce</code></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="debugging.html"><a href="debugging.html#launching-browser-in-code"><i class="fa fa-check"></i><b>4.3</b> Launching browser in code</a></li>
<li class="chapter" data-level="4.4" data-path="debugging.html"><a href="debugging.html#setting-breakpoint-in-editor"><i class="fa fa-check"></i><b>4.4</b> Setting breakpoint in editor</a></li>
<li class="chapter" data-level="4.5" data-path="debugging.html"><a href="debugging.html#launching-debugger-with-recover"><i class="fa fa-check"></i><b>4.5</b> Launching debugger with <code>recover()</code></a></li>
<li class="chapter" data-level="4.6" data-path="debugging.html"><a href="debugging.html#more-tools-for-interactive-debugging"><i class="fa fa-check"></i><b>4.6</b> More tools for interactive debugging</a></li>
<li class="chapter" data-level="4.7" data-path="debugging.html"><a href="debugging.html#noninteractive"><i class="fa fa-check"></i><b>4.7</b> Non-interactive debugging</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="debugging.html"><a href="debugging.html#print-debugging"><i class="fa fa-check"></i><b>4.7.1</b> Print debugging</a></li>
<li class="chapter" data-level="4.7.2" data-path="debugging.html"><a href="debugging.html#dump.frames"><i class="fa fa-check"></i><b>4.7.2</b> <code>dump.frames()</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercises.html"><a href="exercises.html"><i class="fa fa-check"></i><b>5</b> Exercises</a>
<ul>
<li class="chapter" data-level="5.1" data-path="exercises.html"><a href="exercises.html#exercise-on-interactive-debugging"><i class="fa fa-check"></i><b>5.1</b> Exercise on interactive debugging</a></li>
<li class="chapter" data-level="5.2" data-path="exercises.html"><a href="exercises.html#exercise-on-non-interactive-debugging"><i class="fa fa-check"></i><b>5.2</b> Exercise on non-interactive debugging</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Created with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R debugging</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="debugging" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Debugging R code<a href="debugging.html#debugging" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This chapter’s structure follows the excellent <a href="https://adv-r.hadley.nz/debugging.html">debugging-chapter from Advanced R</a><span class="citation"><a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a></span>.</p>
<p>Another excellent source for debugging in RStudio is
<a href="https://support.rstudio.com/hc/en-us/articles/205612627-Debugging-with-the-RStudio-IDE">this blog post</a>
by Jonathan McPherson.<span class="citation"><a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a></span></p>
<div id="tracing-errors" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Tracing errors<a href="debugging.html#tracing-errors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="traceback" class="section level3 hasAnchor" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> Traceback<a href="debugging.html#traceback" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s consider the previously showed function example with a missing variable:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="debugging.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that z is missing</span></span>
<span id="cb30-2"><a href="debugging.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">exists</span>(<span class="st">&quot;z&quot;</span>)) {</span>
<span id="cb30-3"><a href="debugging.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(z)</span>
<span id="cb30-4"><a href="debugging.html#cb30-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-5"><a href="debugging.html#cb30-5" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb30-6"><a href="debugging.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> z)</span>
<span id="cb30-7"><a href="debugging.html#cb30-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-8"><a href="debugging.html#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="debugging.html#cb30-9" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x,<span class="at">y =</span> <span class="fu">g</span>(x)) {</span>
<span id="cb30-10"><a href="debugging.html#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (x<span class="sc">&gt;</span><span class="dv">0</span>) {</span>
<span id="cb30-11"><a href="debugging.html#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(x)</span>
<span id="cb30-12"><a href="debugging.html#cb30-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-13"><a href="debugging.html#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(y)</span>
<span id="cb30-14"><a href="debugging.html#cb30-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-15"><a href="debugging.html#cb30-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-16"><a href="debugging.html#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb30-17"><a href="debugging.html#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in g(x): object &#39;z&#39; not found</span></span></code></pre></div>
<p>This example is available here: <a href="https://raw.githubusercontent.com/AaltoSciComp/r-debugging/main/examples/missing-variables.R">missing-variables.R</a>.</p>
<p>Opening the file with RStudio and sourcing the file will return the following kind of an error:</p>
<p><img src="https://raw.githubusercontent.com/AaltoSciComp/r-debugging/main/images/missing-variables.png" /></p>
<p>Now clicking the <strong>Show traceback</strong>-button will expand the traceback:</p>
<p><img src="https://raw.githubusercontent.com/AaltoSciComp/r-debugging/main/images/missing-variables-traceback.png" /></p>
<p>This view will quickly show that the error comes from the <code>g(x)</code>-function call in line #13.</p>
<p>Sometimes lazy evaluation can make reading the call stack complicated.
Let’s have a few additional functions that are called in the argument definition:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="debugging.html#cb31-1" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb31-2"><a href="debugging.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(z)</span>
<span id="cb31-3"><a href="debugging.html#cb31-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-4"><a href="debugging.html#cb31-4" aria-hidden="true" tabindex="-1"></a>h <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb31-5"><a href="debugging.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">i</span>())</span>
<span id="cb31-6"><a href="debugging.html#cb31-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-7"><a href="debugging.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">x=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">y=</span><span class="fu">h</span>())</span>
<span id="cb31-8"><a href="debugging.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in i(): object &#39;z&#39; not found</span></span></code></pre></div>
<p><img src="https://raw.githubusercontent.com/AaltoSciComp/r-debugging/main/images/missing-variables-lazy-evaluation.png" /></p>
<p>Error is raised by <code>i()</code>, but looking at the call stack it almost looks like <code>f()</code> is somehow involved. This is because value of <code>h()</code> is evaluated only when it is needed in <code>f()</code>. Writing the code like this would reveal the true culprit:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="debugging.html#cb32-1" aria-hidden="true" tabindex="-1"></a>h_value<span class="ot">=</span><span class="fu">h</span>()</span>
<span id="cb32-2"><a href="debugging.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in i(): object &#39;z&#39; not found</span></span>
<span id="cb32-3"><a href="debugging.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="at">x=</span><span class="sc">-</span><span class="dv">1</span>, <span class="at">y=</span>h_value)</span>
<span id="cb32-4"><a href="debugging.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in f(x = -1, y = h_value): object &#39;h_value&#39; not found</span></span></code></pre></div>
<p>Of course, this is not something you want to do generally. Lazy evaluation is good for speeding up your code, so doing changes like this should be limited to situations where you’re unsure which function causes the error.</p>
<p><img src="https://raw.githubusercontent.com/AaltoSciComp/r-debugging/main/images/missing-variables-nonlazy-evaluation.png" /></p>
</div>
<div id="traceback-outside-of-rstudio-editor" class="section level3 hasAnchor" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Traceback outside of RStudio editor<a href="debugging.html#traceback-outside-of-rstudio-editor" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you run the code in R console in RStudio or in a separate interpreter you might not get the <strong>Show Traceback</strong>-prompt.
In those situations you can use the <code>traceback()</code>-function to get the trace. You can try it out with the following test in the console:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="debugging.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb33-2"><a href="debugging.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">traceback</span>()</span></code></pre></div>
<p>You can also set the R error handling to call traceback on errors:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="debugging.html#cb34-1" aria-hidden="true" tabindex="-1"></a>backup_options <span class="ot">&lt;-</span> <span class="fu">options</span>()</span>
<span id="cb34-2"><a href="debugging.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">error=</span>traceback)</span>
<span id="cb34-3"><a href="debugging.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb34-4"><a href="debugging.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(backup_options)</span></code></pre></div>
<p>Here we also took a backup of the default options. This is usually a good idea as changing options will change the options for the whole R session.</p>
</div>
</div>
<div id="interactive-debugger" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Interactive debugger<a href="debugging.html#interactive-debugger" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="launching-debugger-with-rstudios-rerun-with-debug" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Launching debugger with RStudio’s “Rerun with Debug”<a href="debugging.html#launching-debugger-with-rstudios-rerun-with-debug" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>RStudio can launch you a debugger at the location where the error occured. If you source the file again and launch the debugger with <strong>Rerun with Debug</strong>, you’ll get an interactive debugger that looks something like this:</p>
<p><img src="https://raw.githubusercontent.com/AaltoSciComp/r-debugging/main/images/missing-variables-run-with-debug.png" /></p>
<p>This view has many areas of interest:</p>
<ul>
<li>On the top left RStudio will open the source code of the problematic function
and it tries to highlight the line that causes the error.</li>
<li>On the top right we have an environment browser that shows what variables are defined inside
the <code>g()</code>-function’s environment.</li>
<li>On the bottom right we have the traceback of the erroneous function call.
The function we’re investigating is highlighted.</li>
<li>On the bottom left we have the interactive debugger open in the console.</li>
</ul>
</div>
<div id="debugger-commands" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Debugger commands<a href="debugging.html#debugger-commands" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The interactive debugger console has multiple commands (more info available <a href="https://rdrr.io/r/base/browser.html">here</a>):</p>
<ul>
<li>Continue, <code>c</code> or <code>cont</code>: Exit the browser and continue execution at the next statement.</li>
<li>Finish, <code>f</code>: Finish execution of the current loop or function</li>
<li>Help, <code>help</code>: Print this list of commands</li>
<li>Next, <code>n</code> : Evaluate the next statement, stepping over function calls. For byte compiled functions interrupted by browser calls, n is equivalent to c.</li>
<li>Step, <code>s</code>: Evaluate the next statement, stepping into function calls. Again, byte compiled functions make s equivalent to c.</li>
<li>Where, <code>where</code>: Print a stack trace of all active function calls.</li>
<li>Resume, <code>r</code>: Invoke a “resume” restart if one is available; interpreted as an R expression otherwise. Typically “resume” restarts are established for continuing from user interrupts.</li>
<li>Quit, <code>Q</code>: Exit the browser and the current evaluation and return to the top-level prompt.</li>
</ul>
<p>RStudio also has a toolbar in debugger console with buttons for next (<code>n</code>), step (<code>s</code>), finish (<code>f</code>), continue (<code>c</code>) and stop (<code>Q</code>).</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-34"></span>
<img src="https://github.com/hadley/adv-r/raw/master/screenshots/debug-toolbar.png" alt="RStudio debugger toolbar. Source: Advanced R" width="70%" />
<p class="caption">
Figure 4.1: RStudio debugger toolbar. Source: Advanced R
</p>
</div>
<p>In addition to these commands one can run arbitrary R-commands to list variables, test their values etc.</p>
</div>
<div id="debug-and-debugonce" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> <code>debug</code> and <code>debugonce</code><a href="debugging.html#debug-and-debugonce" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can also launch debugger from the console with <code>debug()</code>- and <code>debugonce()</code>-functions.</p>
<p><code>debug(f)</code> will set a permanent flag that will cause a debugger to be launched whenever
function <code>f</code> is called. You can unset this variable with <code>undebug</code>.</p>
<p>Alternatively, you can use <code>debugonce</code> to launch the debugger once for a function. This is
especially useful if the function you want to debug is inside a for-loop. You can try this with the following:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="debugging.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">debugonce</span>(g)</span>
<span id="cb35-2"><a href="debugging.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
</div>
</div>
<div id="launching-browser-in-code" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Launching browser in code<a href="debugging.html#launching-browser-in-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One can also launch the interactive browser by specifying <code>browser()</code> is the code:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="debugging.html#cb36-1" aria-hidden="true" tabindex="-1"></a>g_browse <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb36-2"><a href="debugging.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">browser</span>()</span>
<span id="cb36-3"><a href="debugging.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">+</span> z)</span>
<span id="cb36-4"><a href="debugging.html#cb36-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-5"><a href="debugging.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="at">y=</span><span class="fu">g_browse</span>(x))</span></code></pre></div>
<p>This is very useful when you’re writing new code and you want to check what the function does line-by-line.</p>
</div>
<div id="setting-breakpoint-in-editor" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Setting breakpoint in editor<a href="debugging.html#setting-breakpoint-in-editor" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In RStudio editor you can also set a temporary breakpoint by clicking to the left of the line number.
This will put a red dot next to the line number. This is a break point which will acts like a <code>browser()</code>-call.</p>
<p>Setting breakpoints is even faster way of debugging code while you’re developing it.</p>
</div>
<div id="launching-debugger-with-recover" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Launching debugger with <code>recover()</code><a href="debugging.html#launching-debugger-with-recover" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>You can also launch the debugger when an error occurs by setting the error option to use <code>recover()</code>:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="debugging.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">option</span>(<span class="at">error=</span>recover)</span>
<span id="cb37-2"><a href="debugging.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f</span>(<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb37-3"><a href="debugging.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(backup_options)</span></code></pre></div>
<p>Again, we’ll want to restore the previous settings once we’re finished.</p>
<p>You can also set a similar behaviour in RStudio by checking
<strong>Debug</strong> -&gt; <strong>On Error</strong> -&gt; <strong>Break in Code</strong> from the top menu.</p>
<p>RStudio will try to limit the debugger launching to functions that are written by you.
In some cases, e.g. if you give wrong arguments to a packaged function, this will result in a situation where
you do not get a debugger when you want it. To bypass RStudio’s check, you’ll need to
uncheck <em>Use debug error handler only when my code contains errors</em> in
<strong>Tools</strong> -&gt; <strong>Global Options</strong> -&gt; <strong>General</strong>.</p>
</div>
<div id="more-tools-for-interactive-debugging" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> More tools for interactive debugging<a href="debugging.html#more-tools-for-interactive-debugging" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are plenty of more tools like <code>trace</code>, <code>utils::setBreakpoint()</code> etc. See <a href="https://adv-r.hadley.nz/debugging.html">debugging-chapter from Advanced R</a> for more information on these.</p>
</div>
<div id="noninteractive" class="section level2 hasAnchor" number="4.7">
<h2><span class="header-section-number">4.7</span> Non-interactive debugging<a href="debugging.html#noninteractive" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Non-interactive usage is most common when one wants to run R code in a remote system,
a virtual machine or a container. When running R code non-interactively it is usually
a good idea to verify that the R installation is as similar as possible to the
interactive session.</p>
<p>Using tool such as <a href="https://rstudio.github.io/renv/articles/renv.html">renv</a> can make
it easier to replicate the same environment by storing the list of required packages
into a <code>renv.lock</code>-file.<span class="citation"><a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a></span></p>
<p>Other things such as different package loading order, forgetting to load a package
explicitly or setting some variables outside of the code into the environment
can also create problems.</p>
<div id="print-debugging" class="section level3 hasAnchor" number="4.7.1">
<h3><span class="header-section-number">4.7.1</span> Print debugging<a href="debugging.html#print-debugging" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Print debugging is an age old debugging paradigm that usually works. Few well placed
<code>cat</code>- or <code>print</code>- statements can usually tell a lot about the inner workings of the
program.</p>
<p>More advanced logging packages such as
<a href="https://daroczig.github.io/logger/">logger</a><span class="citation"><a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a></span>,
<a href="https://s-fleck.github.io/lgr/">lgr</a><span class="citation"><a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a></span> or
<a href="https://github.com/johnmyleswhite/log4r">log4r</a><span class="citation"><a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a></span> can be very useful as well
as you can leave many debug statements in your code, but print them only when needed.</p>
<p>One can also utilize R’s
<a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/save">save</a>-function
to save environment variables for further inspection.</p>
</div>
<div id="dump.frames" class="section level3 hasAnchor" number="4.7.2">
<h3><span class="header-section-number">4.7.2</span> <code>dump.frames()</code><a href="debugging.html#dump.frames" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><code>dump.frames()</code> allows you to do a <code>recover()</code> on a code that was run non-interactively by
saving the state of the program on error. One can then use interactive <code>debugger()</code> to look
into the failed program state.</p>
<p>The following example from the relevant section on <a href="https://adv-r.hadley.nz/debugging.html#non-interactive-debugging">Advanced R</a> illustrates the idea perfectly:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="debugging.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In batch R process ----</span></span>
<span id="cb38-2"><a href="debugging.html#cb38-2" aria-hidden="true" tabindex="-1"></a>dump_and_quit <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb38-3"><a href="debugging.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save debugging info to file last.dump.rda</span></span>
<span id="cb38-4"><a href="debugging.html#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dump.frames</span>(<span class="at">to.file =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-5"><a href="debugging.html#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Quit R with error status</span></span>
<span id="cb38-6"><a href="debugging.html#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">q</span>(<span class="at">status =</span> <span class="dv">1</span>)</span>
<span id="cb38-7"><a href="debugging.html#cb38-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb38-8"><a href="debugging.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">error =</span> dump_and_quit)</span>
<span id="cb38-9"><a href="debugging.html#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="debugging.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># In a later interactive session ----</span></span>
<span id="cb38-11"><a href="debugging.html#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;last.dump.rda&quot;</span>)</span>
<span id="cb38-12"><a href="debugging.html#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="fu">debugger</span>()</span></code></pre></div>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="11">
<li id="fn11"><p>Hadley Wickham, <em>Advanced r</em> (CRC press, 2019), <a href="https://adv-r.hadley.nz" role="doc-biblioref">https://adv-r.hadley.nz</a>.<a href="debugging.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>Jonathan McPherson, <span>“Debugging with the RStudio IDE,”</span> 2021, <a href="https://support.rstudio.com/hc/en-us/articles/205612627-Debugging-with-RStudio" role="doc-biblioref">https://support.rstudio.com/hc/en-us/articles/205612627-Debugging-with-RStudio</a>.<a href="debugging.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>Kevin Ushey, <em>Renv: Project Environments</em>, 2022, <a href="https://rstudio.github.io/renv/" role="doc-biblioref">https://rstudio.github.io/renv/</a>.<a href="debugging.html#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>Gergely Daróczi, <em>Logger: A Lightweight, Modern and Flexible Logging Utility</em>, 2021, <a href="https://daroczig.github.io/logger/" role="doc-biblioref">https://daroczig.github.io/logger/</a>.<a href="debugging.html#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p>Stefan Fleck, <em>Lgr: A Fully Featured Logging Framework</em>, 2021, <a href="https://s-fleck.github.io/lgr/" role="doc-biblioref">https://s-fleck.github.io/lgr/</a>.<a href="debugging.html#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>John Myles White and Aaron Jacobs, <em>Log4r: A Fast and Lightweight Logging System for r, Based on Log4j</em>, 2021, <a href="https://github.com/johnmyleswhite/log4r" role="doc-biblioref">https://github.com/johnmyleswhite/log4r</a>.<a href="debugging.html#fnref16" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="features.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercises.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["r-debugging.pdf", "r-debugging.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
